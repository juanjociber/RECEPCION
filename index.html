<!-- <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selección de Partes del Camión</title>
</head>
<body>
    <canvas id="miCanvas" width="800" height="400" style="border:1px solid #000;"></canvas>
    <div>
        <input type="checkbox" id="cabina" value="cabina">
        <label for="cabina">Cabina</label>
        <input type="checkbox" id="ruedas" value="ruedas">
        <label for="ruedas">Ruedas</label>
        <input type="checkbox" id="caja" value="caja">
        <label for="caja">Caja</label>
    </div>

    <script>
        const canvas = document.getElementById('miCanvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.src = '/img/activo.png';  // Ruta de la imagen cargada

        // Dibujar la imagen en el canvas
        img.onload = function() {
            ctx.drawImage(img, 0, 0, 800, 400); // Ajusta las dimensiones según sea necesario
        };

        // Coordenadas de las áreas del camión
        const areas = {
            cabina: { x: 50, y: 100, width: 300, height: 200 },
            ruedas: { x: 350, y: 300, width: 300, height: 100 },
            caja: { x: 400, y: 100, width: 400, height: 200 }
        };

        console.log(areas);

        // Detectar clics en el canvas
        canvas.addEventListener('click', function(event) {
            const x = event.offsetX;
            const y = event.offsetY;

            for (const area in areas) {
                const { x: ax, y: ay, width, height } = areas[area];
                if (x > ax && x < ax + width && y > ay && y < ay + height) {
                    document.getElementById(area).checked = !document.getElementById(area).checked;
                }
            }
        });
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dibujo en Canvas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        #canvas-container {
            position: relative;
            display: inline-block;
        }
        canvas {
            border: 1px solid black;
            width: 100%;
        }
        .modal-backdrop{
            z-index: initial;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-dialog {
            max-width: 500px;
        }
        .modal-content {
            border-radius: 8px;
        }
        .list-group-item.selected {
            background-color: #007bff;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="toolbar mb-3">
            <input type="file" id="imageLoader" class="form-control mb-2" />
            <input type="color" id="colorPicker" class="form-control mb-2" value="#ff0000" />
            <input type="number" id="lineWidth" class="form-control mb-2" value="2" min="1" max="10" />
            <select id="tool" class="form-select mb-2">
                <option value="circle">Círculo</option>
                <option value="rectangle">Rectángulo</option>
                <option value="arrow">Flecha</option>
                <option value="select">Seleccionar</option>
            </select>
            <label class="form-check">
                <input type="checkbox" id="fill" class="form-check-input" />
                <span class="form-check-label">Rellenar</span>
            </label>
            <button id="namePromptButton" class="btn btn-primary">Agregar Nombre</button>
            <button id="deleteButton" class="btn btn-danger">Eliminar Área Seleccionada</button>
        </div>
        <div id="canvas-container" class="mb-3">
            <canvas id="miCanvas" width="800" height="600"></canvas>
        </div>
        <div id="selectedAreas" class="list-group"></div>
    </div>

    <!-- Modal para nombrar -->
    <div id="nameModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Nombre para la Nueva Figura</h5>
                    <button type="button" class="btn-close" id="closeNameModalButton"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="nameInput" class="form-control" placeholder="Nombre" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="closeNameModalButton">Cancelar</button>
                    <button type="button" id="saveNameButton" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para eliminar -->
    <div id="deleteModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" id="closeDeleteModalButton"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que quieres eliminar el área seleccionada?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="closeDeleteModalButton">Cancelar</button>
                    <button type="button" id="confirmDeleteButton" class="btn btn-danger">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script>
        const canvas = document.getElementById('miCanvas');
        const ctx = canvas.getContext('2d');
        let img = new Image();
        let startX, startY, currentX, currentY;
        const shapes = [];
        let color = '#ff0000';
        let lineWidth = 2;
        let tool = 'circle'; // Default tool
        let fill = false;
        let selectedShapeIndex = null;
        let isDrawing = false;

        document.getElementById('imageLoader').addEventListener('change', handleImage, false);
        document.getElementById('colorPicker').addEventListener('input', (e) => color = e.target.value);
        document.getElementById('lineWidth').addEventListener('input', (e) => lineWidth = parseInt(e.target.value, 10));
        document.getElementById('tool').addEventListener('change', (e) => tool = e.target.value);
        document.getElementById('fill').addEventListener('change', (e) => fill = e.target.checked);
        document.getElementById('namePromptButton').addEventListener('click', () => {
            if (shapes.length > 0) {
                const nameInput = document.getElementById('nameInput');
                nameInput.value = shapes[shapes.length - 1].name || ''; // Set name if it exists
                const nameModal = new bootstrap.Modal(document.getElementById('nameModal'));
                nameModal.show();
            }
        });
        document.getElementById('deleteButton').addEventListener('click', () => {
            if (selectedShapeIndex !== null) {
                const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                deleteModal.show();
            }
        });
        document.getElementById('closeNameModalButton').addEventListener('click', () => {
            const nameModal = bootstrap.Modal.getInstance(document.getElementById('nameModal'));
            nameModal.hide();
        });
        document.getElementById('closeDeleteModalButton').addEventListener('click', () => {
            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            deleteModal.hide();
        });
        document.getElementById('saveNameButton').addEventListener('click', saveName);
        document.getElementById('confirmDeleteButton').addEventListener('click', deleteShape);

        function handleImage(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    drawImage();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function drawImage() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            shapes.forEach((shape) => {
                drawShape(shape);
            });
        }

        function drawShape(shape) {
            ctx.beginPath();
            ctx.strokeStyle = shape.color;
            ctx.lineWidth = shape.lineWidth;

            if (shape.type === 'circle') {
                ctx.arc(shape.x, shape.y, shape.radius, 0, 2 * Math.PI);
                if (fill) {
                    ctx.fillStyle = shape.color;
                    ctx.fill();
                }
                ctx.stroke();
            } else if (shape.type === 'rectangle') {
                ctx.rect(shape.x, shape.y, shape.width, shape.height);
                if (fill) {
                    ctx.fillStyle = shape.color;
                    ctx.fill();
                }
                ctx.stroke();
            } else if (shape.type === 'arrow') {
                drawArrow(ctx, shape.startX, shape.startY, shape.endX, shape.endY);
            }

            if (shapes.indexOf(shape) === selectedShapeIndex) {
                ctx.strokeStyle = 'blue';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                if (shape.type === 'circle') {
                    ctx.arc(shape.x, shape.y, shape.radius + 2, 0, 2 * Math.PI);
                } else if (shape.type === 'rectangle') {
                    ctx.rect(shape.x - 2, shape.y - 2, shape.width + 4, shape.height + 4);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function drawArrow(ctx, startX, startY, endX, endY) {
            const headLength = 10;
            const angle = Math.atan2(endY - startY, endX - startX);
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.lineTo(endX - headLength * Math.cos(angle - Math.PI / 6), endY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - headLength * Math.cos(angle + Math.PI / 6), endY - headLength * Math.sin(angle + Math.PI / 6));
        }

        function saveName() {
            const name = document.getElementById('nameInput').value;
            if (shapes.length > 0) {
                shapes[shapes.length - 1].name = name;
                updateSelectedAreas();
                drawImage();
                const nameModal = bootstrap.Modal.getInstance(document.getElementById('nameModal'));
                nameModal.hide();
            }
        }

        function deleteShape() {
            if (selectedShapeIndex !== null) {
                shapes.splice(selectedShapeIndex, 1);
                selectedShapeIndex = null;
                updateSelectedAreas();
                drawImage();
                const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                deleteModal.hide();
            }
        }

        function updateSelectedAreas() {
            const selectedAreas = document.getElementById('selectedAreas');
            selectedAreas.innerHTML = '';
            shapes.forEach((shape, index) => {
                const item = document.createElement('li');
                item.className = 'list-group-item';
                item.textContent = shape.name || 'Sin Nombre';
                item.dataset.index = index;
                item.addEventListener('click', () => {
                    selectedShapeIndex = index;
                    updateSelectedAreas();
                    drawImage();
                });
                selectedAreas.appendChild(item);
            });
        }

        canvas.addEventListener('mousedown', (e) => {
            startX = e.offsetX;
            startY = e.offsetY;
            isDrawing = true;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                currentX = e.offsetX;
                currentY = e.offsetY;
                drawImage(); // Redibuja la imagen y la forma actual en cada movimiento del mouse
                drawCurrentShape(); // Dibuja la forma actual
            }
        });

        canvas.addEventListener('mouseup', (e) => {
            if (isDrawing) {
                const endX = e.offsetX;
                const endY = e.offsetY;
                const newShape = {
                    type: tool,
                    color: color,
                    lineWidth: lineWidth
                };

                if (tool === 'circle') {
                    const radius = Math.sqrt((endX - startX) ** 2 + (endY - startY) ** 2);
                    Object.assign(newShape, {
                        x: startX,
                        y: startY,
                        radius: radius
                    });
                } else if (tool === 'rectangle') {
                    Object.assign(newShape, {
                        x: Math.min(startX, endX),
                        y: Math.min(startY, endY),
                        width: Math.abs(endX - startX),
                        height: Math.abs(endY - startY)
                    });
                } else if (tool === 'arrow') {
                    Object.assign(newShape, {
                        startX: startX,
                        startY: startY,
                        endX: endX,
                        endY: endY
                    });
                }

                shapes.push(newShape);
                updateSelectedAreas();
                drawImage();
                isDrawing = false;
            }
        });

        function drawCurrentShape() {
            const shape = {
                type: tool,
                color: color,
                lineWidth: lineWidth
            };

            if (tool === 'circle') {
                ctx.beginPath();
                const radius = Math.sqrt((currentX - startX) ** 2 + (currentY - startY) ** 2);
                ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                if (fill) {
                    ctx.fillStyle = color;
                    ctx.fill();
                }
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            } else if (tool === 'rectangle') {
                ctx.beginPath();
                ctx.rect(startX, startY, currentX - startX, currentY - startY);
                if (fill) {
                    ctx.fillStyle = color;
                    ctx.fill();
                }
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            } else if (tool === 'arrow') {
                ctx.beginPath();
                drawArrow(ctx, startX, startY, currentX, currentY);
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            }
        }

    </script>
</body>
</html>























